<!DOCTYPE html>
<html lang="bn">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>বই প্রদর্শক (উন্নত জুম)</title>
    <style>
      body,
      html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        font-family: Arial, sans-serif;
        background-color: #2c2c2c;
        color: #fff;
        overflow: hidden;
        /* মোবাইল ডিভাইসে ডিফল্ট জুম এবং স্ক্রলিং বন্ধ করা */
        touch-action: none;
      }
      .viewer-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        height: 100%;
        box-sizing: border-box;
      }
      .image-wrapper {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        margin-bottom: 10px;
        overflow: hidden; /* আমরা JS দিয়ে স্ক্রল কন্ট্রোল করব */
        cursor: grab;
      }
      .image-wrapper.grabbing {
        cursor: grabbing;
      }
      #book-page {
        max-width: 95%;
        max-height: 95%;
        object-fit: contain;
        border-radius: 5px;
        /* মসৃণ জুম এবং প্যান এর জন্য ট্রানজিশন */
        transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        transform-origin: center center; /* জুমের কেন্দ্রবিন্দু */
      }
      .navigation {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        padding: 8px;
        gap: 12px;
        background-color: rgba(40, 40, 40, 0.9);
        border-radius: 50px; /* ক্যাপসুল আকৃতি */
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
      }
      .icon-button {
        width: 44px;
        height: 44px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        border: none;
        border-radius: 50%;
        background-color: #007bff;
        color: white;
        transition: background-color 0.3s, transform 0.1s;
      }
      .icon-button:hover {
        background-color: #0056b3;
      }
      .icon-button:active {
        transform: scale(0.92);
      }
      .icon-button svg {
        width: 24px;
        height: 24px;
      }
      .reset-zoom-btn {
        background-color: #28a745;
      }
      .reset-zoom-btn:hover {
        background-color: #218838;
      }
      .icon-button:disabled {
        background-color: #555;
        cursor: not-allowed;
        opacity: 0.6;
      }
      #page-counter {
        font-size: 16px;
        font-weight: bold;
        padding: 0 10px;
        min-width: 80px;
        text-align: center;
      }
      @media (max-width: 600px) {
        .navigation {
          gap: 8px;
          padding: 6px;
        }
        .icon-button {
          width: 40px;
          height: 40px;
        }
        #page-counter {
          font-size: 14px;
          min-width: 70px;
        }
      }
    </style>
  </head>
  <body>
    <div class="viewer-container">
      <div class="image-wrapper">
        <img id="book-page" src="" alt="বইয়ের পাতা লোড হচ্ছে..." />
      </div>
      <div class="navigation">
        <button id="prev-btn" class="icon-button" title="পূর্ববর্তী পাতা">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
          </svg>
        </button>
        <span id="page-counter"></span>
        <button id="next-btn" class="icon-button" title="পরবর্তী পাতা">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z" />
          </svg>
        </button>
        <span style="width: 15px"></span>
        <button id="zoom-out-btn" class="icon-button" title="জুম আউট">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M19 13H5v-2h14v2z" />
          </svg>
        </button>
        <button
          id="reset-zoom-btn"
          class="icon-button reset-zoom-btn"
          title="জুম রিসেট"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"
            />
          </svg>
        </button>
        <button id="zoom-in-btn" class="icon-button" title="জুম ইন">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
          </svg>
        </button>
      </div>
    </div>

    <script>
      // --- Configuration & State ---
      const imageLinks = [
        "https://i.postimg.cc/xTtH6nDQ/31.jpg",
        "https://i.postimg.cc/ZqydYNWG/32.jpg",
        "https://i.postimg.cc/TwV5gXqJ/33.jpg",
        "https://i.postimg.cc/Hxw8XC4t/34.jpg",
        "https://i.postimg.cc/7hqGNQmj/35.jpg",
        "https://i.postimg.cc/prk9cYSy/36.jpg",
        "https://i.postimg.cc/6qz7bLPj/37.jpg",
        "https://i.postimg.cc/dQ9T0w0c/38.jpg",
        "https://i.postimg.cc/wTTRyZtt/39.jpg",
        "https://i.postimg.cc/DyjJq6Ly/40.jpg",
        "https://i.postimg.cc/tgPsGHcc/41.jpg",
      ];
      const DOM = {
        bookPage: document.getElementById("book-page"),
        imageWrapper: document.querySelector(".image-wrapper"),
        pageCounter: document.getElementById("page-counter"),
        prevBtn: document.getElementById("prev-btn"),
        nextBtn: document.getElementById("next-btn"),
        zoomInBtn: document.getElementById("zoom-in-btn"),
        zoomOutBtn: document.getElementById("zoom-out-btn"),
        resetZoomBtn: document.getElementById("reset-zoom-btn"),
      };

      let state = {
        currentPageIndex: 0,
        scale: 1.0,
        isPinching: false,
        isDragging: false,
        initialPinchDistance: 0,
        lastTap: 0,
        start: { x: 0, y: 0 },
        offset: { x: 0, y: 0 },
      };

      const config = {
        totalPages: imageLinks.length,
        ZOOM_STEP: 0.2,
        MIN_SCALE: 1.0,
        MAX_SCALE: 5.0,
        DEFAULT_PAGE_NUM_START: 31,
        DOUBLE_TAP_ZOOM: 2.5,
      };

      // --- Core Functions ---
      function applyTransform() {
        DOM.bookPage.style.transform = `translate(${state.offset.x}px, ${state.offset.y}px) scale(${state.scale})`;
        DOM.zoomInBtn.disabled = state.scale >= config.MAX_SCALE;
        DOM.zoomOutBtn.disabled = state.scale <= config.MIN_SCALE;
        DOM.imageWrapper.style.cursor = state.scale > 1.0 ? "grab" : "default";
      }

      function resetState() {
        state.scale = 1.0;
        state.offset = { x: 0, y: 0 };
        applyTransform();
      }

      function showPage(index) {
        resetState();
        DOM.bookPage.src = imageLinks[index];
        DOM.pageCounter.textContent = `পাতা ${
          index + config.DEFAULT_PAGE_NUM_START
        } / ${config.totalPages - 1 + config.DEFAULT_PAGE_NUM_START}`;
        DOM.prevBtn.disabled = index === 0;
        DOM.nextBtn.disabled = index === config.totalPages - 1;
        if (index + 1 < config.totalPages)
          new Image().src = imageLinks[index + 1];
        if (index - 1 >= 0) new Image().src = imageLinks[index - 1];
      }

      // --- Event Handlers ---
      // Page Navigation
      DOM.prevBtn.addEventListener("click", () => {
        if (!DOM.prevBtn.disabled) {
          state.currentPageIndex--;
          showPage(state.currentPageIndex);
        }
      });
      DOM.nextBtn.addEventListener("click", () => {
        if (!DOM.nextBtn.disabled) {
          state.currentPageIndex++;
          showPage(state.currentPageIndex);
        }
      });

      // Zoom Buttons
      DOM.zoomInBtn.addEventListener("click", () => {
        state.scale = Math.min(
          config.MAX_SCALE,
          state.scale + config.ZOOM_STEP
        );
        applyTransform();
      });
      DOM.zoomOutBtn.addEventListener("click", () => {
        state.scale = Math.max(
          config.MIN_SCALE,
          state.scale - config.ZOOM_STEP
        );
        if (state.scale === config.MIN_SCALE) resetState();
        else applyTransform();
      });
      DOM.resetZoomBtn.addEventListener("click", resetState);

      // Keyboard Navigation
      document.addEventListener("keydown", (e) => {
        e.key === "ArrowRight" && DOM.nextBtn.click();
        e.key === "ArrowLeft" && DOM.prevBtn.click();
      });

      // Mouse Wheel Zoom
      DOM.imageWrapper.addEventListener("wheel", (e) => {
        e.preventDefault();
        e.deltaY < 0 ? DOM.zoomInBtn.click() : DOM.zoomOutBtn.click();
      });

      // --- Pointer (Mouse & Touch) Handlers for Pan, Pinch, Double-tap ---
      function getDistance(p1, p2) {
        return Math.sqrt(
          Math.pow(p2.clientX - p1.clientX, 2) +
            Math.pow(p2.clientY - p1.clientY, 2)
        );
      }

      function onPointerDown(e) {
        if (e.pointerType === "mouse" && e.button !== 0) return; // Only main mouse button

        if (e.touches && e.touches.length === 2) {
          // Start Pinch
          e.preventDefault();
          state.isPinching = true;
          state.initialPinchDistance = getDistance(e.touches[0], e.touches[1]);
        } else {
          // Start Drag
          state.isDragging = true;
          DOM.imageWrapper.classList.add("grabbing");
          state.start.x = e.pageX || e.touches[0].pageX;
          state.start.y = e.pageY || e.touches[0].pageY;
        }
      }

      function onPointerMove(e) {
        if (state.isPinching && e.touches && e.touches.length === 2) {
          // Pinching
          e.preventDefault();
          const currentDistance = getDistance(e.touches[0], e.touches[1]);
          const newScale =
            state.scale * (currentDistance / state.initialPinchDistance);
          state.scale = Math.max(
            config.MIN_SCALE,
            Math.min(newScale, config.MAX_SCALE)
          );
          state.initialPinchDistance = currentDistance; // Update for continuous pinch
          applyTransform();
        } else if (state.isDragging && state.scale > 1) {
          // Dragging
          e.preventDefault();
          const currentX = e.pageX || e.touches[0].pageX;
          const currentY = e.pageY || e.touches[0].pageY;
          state.offset.x += currentX - state.start.x;
          state.offset.y += currentY - state.start.y;
          state.start.x = currentX;
          state.start.y = currentY;
          applyTransform();
        }
      }

      function onPointerUp(e) {
        // Double Tap/Click
        const currentTime = new Date().getTime();
        if (currentTime - state.lastTap < 300) {
          if (state.scale > 1) {
            resetState();
          } else {
            state.scale = config.DOUBLE_TAP_ZOOM;
            applyTransform();
          }
        }
        state.lastTap = currentTime;

        state.isDragging = false;
        state.isPinching = false;
        DOM.imageWrapper.classList.remove("grabbing");
      }

      DOM.imageWrapper.addEventListener("mousedown", onPointerDown);
      DOM.imageWrapper.addEventListener("mousemove", onPointerMove);
      window.addEventListener("mouseup", onPointerUp); // Use window to catch mouseup outside wrapper

      DOM.imageWrapper.addEventListener("touchstart", onPointerDown, {
        passive: false,
      });
      DOM.imageWrapper.addEventListener("touchmove", onPointerMove, {
        passive: false,
      });
      DOM.imageWrapper.addEventListener("touchend", onPointerUp);

      // Initial Load
      showPage(state.currentPageIndex);
    </script>
  </body>
</html>
