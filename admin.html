<!doctype html>
<html lang="bn">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
            id="viewportMeta"
        />
        <title>অ্যাডমিন প্যানেল - Study With Keshab</title>
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#4a90e2" />

        <!-- ফন্টস এবং আইকন -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        />
        <link rel="stylesheet" href="css/admin.css" />
    </head>
    <body>
        <div class="admin-page-container">
            <!-- সাইডবার (বাম পাশের মেনু) -->
            <aside class="sidebar">
                <div>
                    <div class="sidebar-header">
                        <img
                            src="images/logo.jpg"
                            alt="Logo"
                            class="sidebar-logo"
                        />
                        <h2>Admin Panel</h2>
                    </div>
                    <nav class="sidebar-nav">
                        <ul>
                            <li class="active">
                                <a href="#" id="nav-dashboard"
                                    ><i class="fas fa-tachometer-alt fa-fw"></i>
                                    ড্যাশবোর্ড</a
                                >
                            </li>
                            <li>
                                <a href="#" id="nav-leaderboard"
                                    ><i class="fas fa-trophy fa-fw"></i>
                                    লিডারবোর্ড</a
                                >
                            </li>
                            <li>
                                <a href="index.html"
                                    ><i class="fas fa-home fa-fw"></i> হোম পেজে
                                    যান</a
                                >
                            </li>
                        </ul>
                    </nav>
                </div>
                <div
                    class="sidebar-footer"
                    id="admin-info-sidebar"
                    style="display: none"
                >
                    <img
                        src=""
                        alt="Admin Profile"
                        id="admin-profile-pic-sidebar"
                        class="admin-pic"
                    />
                    <div class="admin-details">
                        <span id="admin-name-sidebar"></span>
                        <small>Administrator</small>
                    </div>
                    <a href="#" id="admin-logout-btn" title="লগ আউট"
                        ><i class="fas fa-sign-out-alt"></i
                    ></a>
                </div>
            </aside>

            <!-- মূল কন্টেন্ট (ডান পাশের অংশ) -->
            <main class="main-content">
                <header class="main-header">
                    <div>
                        <h1 id="page-title">ড্যাশবোর্ড</h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb" id="breadcrumb-nav">
                                <li class="breadcrumb-item">
                                    <a href="#">Admin</a>
                                </li>
                                <li
                                    class="breadcrumb-item active"
                                    aria-current="page"
                                >
                                    Dashboard
                                </li>
                            </ol>
                        </nav>
                    </div>
                    <button class="mobile-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </header>

                <!-- ড্যাশবোর্ড সেকশন -->
                <div id="dashboard-content" class="content-section">
                    <section class="dashboard-stats">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <div>
                                <span class="stat-value" id="total-users"
                                    >0</span
                                ><span class="stat-label">মোট ব্যবহারকারী</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-user-shield"></i>
                            <div>
                                <span class="stat-value" id="total-admins"
                                    >0</span
                                ><span class="stat-label">মোট অ্যাডমিন</span>
                            </div>
                        </div>
                    </section>

                    <!-- বিজ্ঞপ্তির সেকশন (আপডেট করা হয়েছে) -->
                    <section class="send-notification-section">
                        <div class="section-header">
                            <h2>বিজ্ঞপ্তি পাঠান</h2>
                        </div>
                        <!-- আগের আইডিগুলো ব্যবহার করা হচ্ছে -->
                        <form id="notification-form">
                            <div class="form-group">
                                <label for="notification-title">শিরোনাম</label>
                                <input
                                    type="text"
                                    id="notification-title"
                                    placeholder="নোটিফিকেশনের শিরোনাম দিন"
                                    required
                                />
                            </div>
                            <div class="form-group">
                                <label for="notification-body">বার্তা</label>
                                <textarea
                                    id="notification-body"
                                    rows="3"
                                    placeholder="বিস্তারিত বার্তা লিখুন"
                                    required
                                ></textarea>
                            </div>
                            <div class="form-group">
                                <label for="notification-link"
                                    >লিঙ্ক (ঐচ্ছিক)</label
                                >
                                <input type="text" id="notification-link" placeholder="যেমন: index.html বা কোনো URL" />
                            </div>
                            <button type="submit" class="send-btn">
                                <i class="fas fa-paper-plane"></i> পাঠান
                            </button>
                        </form>
                        <div id="notification-status"></div>
                    </section>

                    <section class="user-list-section">
                        <div class="section-header">
                            <h2>ব্যবহারকারীদের তালিকা</h2>
                            <div class="search-box">
                                <i class="fas fa-search"></i
                                ><input
                                    type="text"
                                    id="user-search-input"
                                    placeholder="খুঁজুন..."
                                />
                            </div>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>ছবি</th>
                                        <th>নাম</th>
                                        <th>ইমেইল</th>
                                        <th>ভূমিকা</th>
                                        <th>শেষ লগইন</th>
                                        <th>অ্যাকশন</th>
                                    </tr>
                                </thead>
                                <tbody id="user-table-body"></tbody>
                            </table>
                            <div
                                class="loading-spinner"
                                id="user-list-loading"
                            ></div>
                        </div>
                    </section>

                    <section class="notification-history-section">
                        <div class="section-header">
                            <h2>বিজ্ঞপ্তির ইতিহাস</h2>
                            <button
                                id="clear-all-history-btn"
                                class="btn-danger"
                            >
                                <i class="fas fa-trash-alt"></i> সব মুছুন
                            </button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>শিরোনাম</th>
                                        <th>বার্তা</th>
                                        <th>সময়</th>
                                        <th>অ্যাকশন</th>
                                    </tr>
                                </thead>
                                <tbody id="notification-history-body"></tbody>
                            </table>
                            <div
                                class="loading-spinner"
                                id="notification-history-loading"
                            ></div>
                        </div>
                    </section>
                </div>

                <!-- লিডারবোর্ড সেকশন -->
                <div
                    id="leaderboard-content"
                    class="content-section"
                    style="display: none"
                >
                    <section class="leaderboard-section-inner">
                        <div class="section-header"><h2>লিডারবোর্ড</h2></div>
                        <div class="leaderboard-controls">
                            <label for="chapter-select"
                                >বিষয় নির্বাচন করুন:</label
                            ><select id="chapter-select">
                                <option value="">-- বিষয় বাছুন --</option>
                            </select>
                        </div>
                        <div class="table-container">
                            <table id="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>ব্যবহারকারী</th>
                                        <th>মোট স্কোর</th>
                                        <th>অ্যাকশন</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboard-table-body"></tbody>
                            </table>
                            <div
                                class="loading-spinner"
                                id="leaderboard-loading"
                            ></div>
                        </div>
                    </section>
                </div>
            </main>
        </div>

        <div id="score-details-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h3 id="modal-user-name"></h3>
                <table id="modal-score-table">
                    <thead>
                        <tr>
                            <th>সেট এর নাম</th>
                            <th>প্রাপ্ত নম্বর</th>
                            <th>মোট নম্বর</th>
                        </tr>
                    </thead>
                    <tbody id="modal-score-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="access-denied" style="display: none">
            <h1>
                <i class="fas fa-exclamation-triangle"></i> প্রবেশাধিকার নেই
            </h1>
            <p>এই পেজটি দেখার জন্য আপনার অনুমতি নেই।</p>
            <a href="index.html">হোম পেজে ফিরে যান</a>
        </div>

                <!-- PWA এবং ডেস্কটপ মোড লজিক (যা আগে ছিল তাই থাকবে) -->
        <script>
            // ... আপনার ডেস্কটপ মোড এবং PWA স্ক্রিপ্ট এখানে থাকবে ...
            // (এটা যেমন আছে তেমনই রাখুন, হাত দেওয়ার দরকার নেই)
        </script>

        <!-- Firebase SDK (Compat Version) -->
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>
        
        <!-- Firebase Config -->
        <script>
            const firebaseConfig = {
                apiKey: "AIzaSyBEhbEWRfuCh_wuXPiQdG8l5TW6L5Ssi1Y",
                authDomain: "study-with-keshab.firebaseapp.com",
                projectId: "study-with-keshab",
                storageBucket: "study-with-keshab.firebasestorage.app",
                messagingSenderId: "752692165545",
                appId: "1:752692165545:web:219ff482874717c3ab22b8",
                measurementId: "G-QH5ELRG2DE"
            };
            firebase.initializeApp(firebaseConfig);
        </script>
        
        <!-- Admin Logic -->
        <script src="js/admin.js"></script>

    </body>
</html>
        <!-- === নোটিফিকেশন পাঠানোর লজিক (Existing Form এর সাথে যুক্ত) === -->
        <script type="module">
            import { db } from './js/firebase-config.js';
            import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

            const notificationForm = document.getElementById('notification-form');
            
            if(notificationForm){
                notificationForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const title = document.getElementById('notification-title').value;
                    const message = document.getElementById('notification-body').value;
                    const link = document.getElementById('notification-link').value || '#';
                    const submitBtn = notificationForm.querySelector('.send-btn');

                    if(!title || !message) {
                        alert("দয়া করে শিরোনাম এবং বার্তা লিখুন!");
                        return;
                    }

                    // বাটন ডিসেবল করা যাতে ডাবল ক্লিক না হয়
                    const originalBtnText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> পাঠানো হচ্ছে...';
                    submitBtn.disabled = true;

                    try {
                        await addDoc(collection(db, "notifications"), {
                            title: title,
                            message: message,
                            link: link,
                            date: new Date().toLocaleDateString('bn-BD'),
                            timestamp: serverTimestamp(),
                            icon: "fa-solid fa-bell"
                        });
                        
                        alert("✅ বিজ্ঞপ্তি সফলভাবে পাঠানো হয়েছে!");
                        notificationForm.reset(); // ফর্ম ক্লিয়ার করা
                    } catch (e) {
                        console.error("Error adding document: ", e);
                        alert("❌ ভুল হয়েছে: " + e.message);
                    } finally {
                        submitBtn.innerHTML = originalBtnText;
                        submitBtn.disabled = false;
                    }
                });
            }
        </script>

        <!-- === নতুন যোগ করা PWA এবং ডেস্কটপ মোড বাটন কোড === -->
        <button
            id="toggleViewBtn"
            style="
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                padding: 10px 15px;
                font-size: 14px;
                background-color: #333;
                color: white;
                border: none;
                border-radius: 50px;
                cursor: pointer;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            "
        >
            ডেস্কটপ মোড
        </button>

        <script>
            // --- 1. Service Worker Registration ---
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("sw.js")
                        .then((registration) => {
                            console.log("ServiceWorker registration successful!");
                        })
                        .catch((err) => {
                            console.log("ServiceWorker registration failed: ", err);
                        });
                });
            }

            // --- 2. Desktop/Mobile Mode Toggle Logic ---
            const toggleBtn = document.getElementById("toggleViewBtn");
            const viewportMeta = document.getElementById("viewportMeta");

            let isDesktopView = localStorage.getItem("viewMode") === "desktop";

            function applyViewMode() {
                if (isDesktopView) {
                    viewportMeta.setAttribute("content", "width=1280");
                    toggleBtn.textContent = "মোবাইল মোড";
                } else {
                    viewportMeta.setAttribute("content", "width=device-width, initial-scale=1.0");
                    toggleBtn.textContent = "ডেস্কটপ মোড";
                }
            }

            toggleBtn.addEventListener("click", () => {
                isDesktopView = !isDesktopView;
                if (isDesktopView) {
                    localStorage.setItem("viewMode", "desktop");
                } else {
                    localStorage.setItem("viewMode", "mobile");
                }
                applyViewMode();
            });

            applyViewMode();
        </script>
    </body>
</html>