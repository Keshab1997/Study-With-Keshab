<!doctype html>
<html lang="bn">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
            id="viewportMeta"
        />
        <title>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ - Study With Keshab</title>
        <link rel="manifest" href="manifest.json" />
        <meta name="theme-color" content="#4a90e2" />

        <!-- ‡¶´‡¶®‡ßç‡¶ü‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶á‡¶ï‡¶® -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        />
        <link rel="stylesheet" href="css/admin.css" />
        
        <!-- Supabase ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡¶°‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶Ö‡¶§‡¶ø‡¶∞‡¶ø‡¶ï‡ßç‡¶§ CSS -->
        <style>
            .supabase-modal {
                display: none; 
                position: fixed; 
                z-index: 2000; 
                left: 0;
                top: 0;
                width: 100%; 
                height: 100%; 
                overflow: auto; 
                background-color: rgba(0,0,0,0.5);
                align-items: center;
                justify-content: center;
            }
            .sb-modal-content {
                background-color: #fff;
                padding: 25px;
                border-radius: 10px;
                width: 90%;
                max-width: 500px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                position: relative;
                animation: slideDown 0.3s ease-out;
            }
            @keyframes slideDown {
                from {transform: translateY(-50px); opacity: 0;}
                to {transform: translateY(0); opacity: 1;}
            }
            .sb-close {
                position: absolute;
                right: 20px;
                top: 15px;
                font-size: 24px;
                font-weight: bold;
                color: #aaa;
                cursor: pointer;
            }
            .sb-close:hover { color: #000; }
            .sb-form-group { margin-bottom: 15px; }
            .sb-form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
            .sb-form-group input, .sb-form-group textarea {
                width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: 'Hind Siliguri', sans-serif;
            }
            .sb-btn-submit {
                background-color: #4a90e2; color: white; border: none; padding: 10px 20px;
                border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px;
            }
            .sb-btn-submit:hover { background-color: #357abd; }
            .create-notif-btn {
                background: linear-gradient(135deg, #2ecc71, #27ae60);
                color: white; border: none; padding: 12px 20px; border-radius: 8px;
                cursor: pointer; font-size: 16px; margin-bottom: 20px; display: inline-flex; align-items: center; gap: 8px;
            }
        </style>
    </head>
    <body>
        <div class="admin-page-container">
            <!-- ‡¶∏‡¶æ‡¶á‡¶°‡¶¨‡¶æ‡¶∞ (‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶Æ‡ßá‡¶®‡ßÅ) -->
            <aside class="sidebar">
                <div>
                    <div class="sidebar-header">
                        <img
                            src="images/logo.jpg"
                            alt="Logo"
                            class="sidebar-logo"
                        />
                        <h2>Admin Panel</h2>
                    </div>
                    <nav class="sidebar-nav">
                        <ul>
                            <li class="active">
                                <a href="#" id="nav-dashboard"
                                    ><i class="fas fa-tachometer-alt fa-fw"></i>
                                    ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</a
                                >
                            </li>
                            <li>
                                <a href="#" id="nav-leaderboard"
                                    ><i class="fas fa-trophy fa-fw"></i>
                                    ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</a
                                >
                            </li>
                            <li>
                                <a href="index.html"
                                    ><i class="fas fa-home fa-fw"></i> ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú‡ßá
                                    ‡¶Ø‡¶æ‡¶®</a
                                >
                            </li>
                        </ul>
                    </nav>
                </div>
                <div
                    class="sidebar-footer"
                    id="admin-info-sidebar"
                    style="display: none"
                >
                    <img
                        src=""
                        alt="Admin Profile"
                        id="admin-profile-pic-sidebar"
                        class="admin-pic"
                    />
                    <div class="admin-details">
                        <span id="admin-name-sidebar"></span>
                        <small>Administrator</small>
                    </div>
                    <a href="#" id="admin-logout-btn" title="‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü"
                        ><i class="fas fa-sign-out-alt"></i
                    ></a>
                </div>
            </aside>

                        <!-- ‡¶Æ‡ßÇ‡¶≤ ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü (‡¶°‡¶æ‡¶® ‡¶™‡¶æ‡¶∂‡ßá‡¶∞ ‡¶Ö‡¶Ç‡¶∂) -->
            <main class="main-content">
                <header class="main-header">
                    <div>
                        <h1 id="page-title">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</h1>
                        <!-- ‡¶¨‡ßç‡¶∞‡ßá‡¶°‡¶ï‡ßç‡¶∞‡¶æ‡¶Æ‡ßç‡¶¨ (Breadcrumb) ‡¶Ö‡¶Ç‡¶∂‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -->
                    </div>
                    <button class="mobile-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </header>

                <!-- ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                <div id="dashboard-content" class="content-section">
                    <section class="dashboard-stats">
                        <div class="stat-card">
                            <i class="fas fa-users"></i>
                            <div>
                                <span class="stat-value" id="total-users"
                                    >0</span
                                ><span class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-user-shield"></i>
                            <div>
                                <span class="stat-value" id="total-admins"
                                    >0</span
                                ><span class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</span>
                            </div>
                        </div>
                    </section>

                    <!-- Supabase Notification Section (Updated) -->
                    <section class="send-notification-section">
                        <div class="section-header">
                            <h2>‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                        </div>
                        <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ø‡¶æ ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶¨‡ßá -->
                        <button id="open-supabase-modal-btn" class="create-notif-btn">
                            <i class="fas fa-bell"></i> ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶™‡ßç‡¶§‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®
                        </button>

                        <div class="section-header" style="margin-top: 20px;">
                            <h3>‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶™‡ßç‡¶§‡¶ø‡¶∞ ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏ (Supabase)</h3>
                            <button id="refresh-history-btn" class="btn-sm" style="background:#666; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">
                                <i class="fas fa-sync"></i> ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
                            </button>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</th>
                                        <th>‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ</th>
                                        <th>‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                        <th>‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏</th>
                                        <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                                    </tr>
                                </thead>
                                <tbody id="supabase-history-body">
                                    <!-- JS ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶∏‡¶¨‡ßá -->
                                </tbody>
                            </table>
                            <div class="loading-spinner" id="sb-history-loading" style="display:none;"></div>
                        </div>
                    </section>

                    <!-- ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                    <section class="class-management-section">
                        <div class="section-header">
                            <h2>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h2>
                        </div>
                        
                        <div class="class-editor-container">
                            <div class="form-group">
                                <label>‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®:</label>
                                <select id="existingClasses" onchange="loadSelectedClass()" style="border: 2px solid #4a90e2; padding: 8px; border-radius: 5px; width: 100%;">
                                    <option value="">-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ü‡¶á‡¶°‡¶ø (Unique ID):</label>
                                <input type="text" id="docId" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: class1" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div class="form-group">
                                <label>‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ:</label>
                                <input type="text" id="classTitle" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: Class 01: Formulas" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                            </div>
                            
                            <div class="form-group">
                                <label>‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü:</label>
                                <div id="editor" style="height: 300px; border: 1px solid #ddd; border-radius: 5px;"></div>
                            </div>

                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="btn btn-save" style="flex: 2; background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer;" onclick="saveClassData()">üíæ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                                <button id="deleteBtn" class="btn" style="flex: 1; background: #dc3545; color: white; border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer; display: none;" onclick="deleteClassData()">üóëÔ∏è ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü</button>
                            </div>
                        </div>
                    </section>

                    <section class="user-list-section">
                        <div class="section-header">
                            <h2>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ</h2>
                            <div class="search-box">
                                <i class="fas fa-search"></i
                                ><input
                                    type="text"
                                    id="user-search-input"
                                    placeholder="‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®..."
                                />
                            </div>
                        </div>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>‡¶õ‡¶¨‡¶ø</th>
                                        <th>‡¶®‡¶æ‡¶Æ</th>
                                        <th>‡¶á‡¶Æ‡ßá‡¶á‡¶≤</th>
                                        <th>‡¶≠‡ßÇ‡¶Æ‡¶ø‡¶ï‡¶æ</th>
                                        <th>‡¶∂‡ßá‡¶∑ ‡¶≤‡¶ó‡¶á‡¶®</th>
                                        <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                                    </tr>
                                </thead>
                                <tbody id="user-table-body"></tbody>
                            </table>
                            <div
                                class="loading-spinner"
                                id="user-list-loading"
                            ></div>
                        </div>
                    </section>
                </div>

                <!-- ‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
                <div
                    id="leaderboard-content"
                    class="content-section"
                    style="display: none"
                >
                    <section class="leaderboard-section-inner">
                        <div class="section-header"><h2>‡¶≤‡¶ø‡¶°‡¶æ‡¶∞‡¶¨‡ßã‡¶∞‡ßç‡¶°</h2></div>
                        <div class="leaderboard-controls">
                            <label for="chapter-select"
                                >‡¶¨‡¶ø‡¶∑‡ßü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:</label
                            ><select id="chapter-select">
                                <option value="">-- ‡¶¨‡¶ø‡¶∑‡ßü ‡¶¨‡¶æ‡¶õ‡ßÅ‡¶® --</option>
                            </select>
                        </div>
                        <div class="table-container">
                            <table id="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ</th>
                                        <th>‡¶Æ‡ßã‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</th>
                                        <th>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                                    </tr>
                                </thead>
                                <tbody id="leaderboard-table-body"></tbody>
                            </table>
                            <div
                                class="loading-spinner"
                                id="leaderboard-loading"
                            ></div>
                        </div>
                    </section>
                </div>
            </main>
        </div>

        <!-- Firebase Score Modal -->
        <div id="score-details-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h3 id="modal-user-name"></h3>
                <table id="modal-score-table">
                    <thead>
                        <tr>
                            <th>‡¶∏‡ßá‡¶ü ‡¶è‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                            <th>‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                            <th>‡¶Æ‡ßã‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</th>
                        </tr>
                    </thead>
                    <tbody id="modal-score-table-body"></tbody>
                </table>
            </div>
        </div>

        <!-- === ‡¶®‡¶§‡ßÅ‡¶® Supabase ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡¶°‡¶æ‡¶≤ === -->
        <div id="supabaseNotificationModal" class="supabase-modal" style="display: none;">
            <div class="sb-modal-content">
                <span class="sb-close" id="close-sb-modal">&times;</span>
                <h2 style="text-align: center; color: #333; margin-bottom: 20px;">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶™‡ßç‡¶§‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®</h2>
                <form id="sb-notification-form">
                    <div class="sb-form-group">
                        <label for="sb-title">‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ</label>
                        <input type="text" id="sb-title" placeholder="‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®" required>
                    </div>
                    <div class="sb-form-group">
                        <label for="sb-message">‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ</label>
                        <textarea id="sb-message" rows="4" placeholder="‡¶Æ‡ßÇ‡¶≤ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." required></textarea>
                    </div>
                    <div class="sb-form-group">
                        <label for="sb-expiry">‡¶ï‡¶§‡¶¶‡¶ø‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá? (‡¶¶‡¶ø‡¶®)</label>
                        <input type="number" id="sb-expiry" value="7" min="1">
                    </div>
                    <button type="submit" class="sb-btn-submit">
                        <i class="fas fa-paper-plane"></i> ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                </form>
            </div>
        </div>

        <div id="access-denied" style="display: none">
            <h1>
                <i class="fas fa-exclamation-triangle"></i> ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂‡¶æ‡¶ß‡¶ø‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á
            </h1>
            <p>‡¶è‡¶á ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶®‡ßá‡¶á‡•§</p>
            <a href="index.html">‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</a>
        </div>

        <!-- Firebase SDKs -->
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-functions.js"></script>
        
        <!-- Supabase SDK (‡¶®‡¶§‡ßÅ‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá) -->
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

        <script src="js/firebase-config.js"></script>
        <script src="js/admin.js"></script>

        <!-- Quill Editor for Class Management -->
        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

        <script>
            // Quill Editor initialization
            let quill;
            document.addEventListener('DOMContentLoaded', function() {
                quill = new Quill('#editor', {
                    theme: 'snow',
                    modules: {
                        toolbar: [
                            ['bold', 'italic', 'underline'],
                            ['blockquote', 'code-block'],
                            [{ 'header': 1 }, { 'header': 2 }],
                            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                            ['link', 'image'],
                            ['clean']
                        ]
                    }
                });
                loadClassList();
            });

            // ‡ßß. ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            function loadSelectedClass() {
                const id = document.getElementById('existingClasses').value;
                const deleteBtn = document.getElementById('deleteBtn');

                if(!id) { 
                    resetClassForm(); 
                    deleteBtn.style.display = "none"; // ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶π‡¶≤‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã
                    return; 
                }

                deleteBtn.style.display = "inline-block"; // ‡¶™‡ßÅ‡¶∞‡¶®‡ßã ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶π‡¶≤‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
                
                db.collection("class_notes").doc(id).get().then(doc => {
                    if(doc.exists) {
                        document.getElementById('docId').value = doc.id;
                        document.getElementById('classTitle').value = doc.data().title;
                        quill.root.innerHTML = doc.data().content;
                    }
                });
            }

            // ‡ß®. ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
            async function deleteClassData() {
                const id = document.getElementById('docId').value;
                if(!id) return;

                if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Ø‡ßá ‡¶è‡¶á ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶∞ ‡¶´‡¶ø‡¶∞‡ßá ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§")) {
                    try {
                        await db.collection("class_notes").doc(id).delete();
                        alert("‡¶ï‡ßç‡¶≤‡¶æ‡¶∏‡¶ü‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
                        resetClassForm();
                        loadClassList(); // ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                    } catch (error) {
                        alert("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: " + error.message);
                    }
                }
            }

            // ‡ß©. ‡¶´‡¶∞‡ßç‡¶Æ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
            function resetClassForm() {
                document.getElementById('docId').value = "";
                document.getElementById('classTitle').value = "";
                if(quill) quill.root.innerHTML = "";
                document.getElementById('deleteBtn').style.display = "none";
            }

            // ‡ß™. ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            function loadClassList() {
                const select = document.getElementById('existingClasses');
                db.collection("class_notes").get().then(querySnapshot => {
                    select.innerHTML = '<option value="">-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® --</option>';
                    querySnapshot.forEach(doc => {
                        const option = document.createElement('option');
                        option.value = doc.id;
                        option.textContent = doc.data().title || doc.id;
                        select.appendChild(option);
                    });
                });
            }

            // ‡ß´. ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
            async function saveClassData() {
                const id = document.getElementById('docId').value;
                const title = document.getElementById('classTitle').value;
                const content = quill.root.innerHTML;

                if(!id || !title) {
                    alert('‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá');
                    return;
                }

                try {
                    await db.collection("class_notes").doc(id).set({
                        title: title,
                        content: content,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                    loadClassList();
                } catch (error) {
                    alert('‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ: ' + error.message);
                }
            }
        </script>

        <!-- Desktop/Mobile Mode Toggle Button -->
        <button
            id="toggleViewBtn"
            style="
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                padding: 10px 15px;
                font-size: 14px;
                background-color: #333;
                color: white;
                border: none;
                border-radius: 50px;
                cursor: pointer;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            "
        >
            ‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶Æ‡ßã‡¶°
        </button>

        <script>
            // --- Service Worker & View Mode Logic ---
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker.register("sw.js").catch(err => console.log("SW failed: ", err));
                });
            }

            const toggleBtn = document.getElementById("toggleViewBtn");
            const viewportMeta = document.getElementById("viewportMeta");
            let isDesktopView = localStorage.getItem("viewMode") === "desktop";

            function applyViewMode() {
                if (isDesktopView) {
                    viewportMeta.setAttribute("content", "width=1280");
                    toggleBtn.textContent = "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Æ‡ßã‡¶°";
                } else {
                    viewportMeta.setAttribute("content", "width=device-width, initial-scale=1.0");
                    toggleBtn.textContent = "‡¶°‡ßá‡¶∏‡ßç‡¶ï‡¶ü‡¶™ ‡¶Æ‡ßã‡¶°";
                }
            }

            toggleBtn.addEventListener("click", () => {
                isDesktopView = !isDesktopView;
                localStorage.setItem("viewMode", isDesktopView ? "desktop" : "mobile");
                applyViewMode();
            });
            applyViewMode();
        </script>
    </body>
</html>