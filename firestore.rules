rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users কালেকশনের নিয়ম
    match /users/{userId} {
      // যে কেউ নিজের ডকুমেন্ট পড়তে পারবে।
      allow get: if request.auth.uid == userId;

      // যে কোনো অথেন্টিকেটেড ব্যবহারকারী অন্য ব্যবহারকারীর তালিকা পড়তে পারবে,
      // কিন্তু শুধুমাত্র অ্যাডমিনরাই অ্যাডমিন প্যানেলে প্রবেশ করতে পারবে (এটি JS কোডে চেক করা হয়েছে)।
      // এই নিয়মটি অ্যাডমিন প্যানেলকে কাজ করার জন্য প্রয়োজনীয় ডেটা পড়তে দেয়।
      allow list: if request.auth != null;
      
      // একজন ব্যবহারকারী শুধুমাত্র নিজের তথ্য আপডেট করতে পারবে।
      allow update: if request.auth.uid == userId;
      
      // নতুন ব্যবহারকারী তৈরি করার অনুমতি।
      allow create: if request.auth != null;
    }

    // NotificationQueue কালেকশনের নিয়ম
    match /notificationQueue/{docId} {
      // শুধুমাত্র অ্যাডমিনরাই এই কালেকশনে লিখতে পারবে।
      // এই get() ফাংশনটি কাজ করা উচিত কারণ উপরের নিয়মে অ্যাডমিনকে পড়ার অনুমতি দেওয়া আছে।
      allow create: if get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
      
      // অন্য কোনো অপারেশন (read, update, delete) ক্লায়েন্ট থেকে করা যাবে না।
      allow read, update, delete: if false;
    }

    // Notifications কালেকশনের নিয়ম
    match /notifications/{notificationId} {
      // যে কোনো অথেন্টিকেটেড ব্যবহারকারী নোটিফিকেশন পড়তে পারবে।
      allow read: if request.auth != null;
      
      // ক্লায়েন্ট থেকে নোটিফিকেশন লেখা যাবে না।
      allow write: if false;
    }
  }
}